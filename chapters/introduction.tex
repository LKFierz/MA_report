\chapter{Introduction}
\label{sec:introduction}

With the Ingenuity rotorcraft's life cycle ending, the question about future Mars rotorcrafts and their capabilities draws ever closer.

Currently, NASA is developing two different rotorcraft Mars concepts for the future. 

\begin{itemize}
    \item Mars sample return helicopter concept

    The first is associated with the Mars Sample Return mission, which has since been canceled. In this mission, NASA's Perseverance rover collects Mars rock and sand samples in test tubes. Subsequently, these tubes are returned to a sample retrieval landing platform, from which a small rocket (Mars Ascent Vehicle) launches them into Mars orbit. ESA's Earth Return Orbiter will enclose them in a highly secure containment capsule and deliver them to Earth.
    
    In case the Perseverance rover won't be able to collect the test samples and deliver them to the lander, a Mars Sample Return helicopter concept is envisioned. This is a rotorcraft for low altitudes equipped with a mechanical gripper, offering an alternative way of transporting Mars samples to the retrieval station should the Perseverance rover fail to do so.

    \item Mars Science Helicopter (MSH)

    Secondly, NASA is conceptualizing a Mars Science Helicopter (MSH) project for future exploratory large-distance missions. The aspirations for such a rotorcraft are to cover farther distances at high altitudes and explore unknown terrain in higher resolution than the HiRISE orbiter camera can. This rotorcraft will use accurate onboard state estimation to navigate through a mission trajectory and land safely, autonomously, and reliably in previously unknown terrain. These two feats allow a Mars helicopter to perform much more advanced science missions than Ingenuity. 
\end{itemize}

The Long Range Navigation (LORNA) project I have been involved with is developing an approach to tackle the second project's challenges while dealing with the constraints that rotorcraft missions on Mars provide us with. These are, namely, a limitation on the size and weight of the drone, a constraint on computational power due to the deployment of limited embedded processors, and lastly, a large delay in communication, which makes adaptive remote control from Earth impossible.

\section{Objective}

The conclusive high-level objective of the LORNA science concept is the achievement of long-range safe navigation, including global localization, safe landing site detection, and full system autonomy. The navigation endeavor is tackled using a laser-range-finder augmented visual-inertial odometry state estimator, which uses map-based localization to achieve global localization. Landing site acquisition is achieved using a structure from motion-based 3D terrain reconstruction. This output is fed into a landing site detection node creating a multi-resolution dense elevation map for landing zone segmentation. Finally, a state machine-based autonomy framework orchestrates the entire procedural workflow.

The endeavor in this thesis was to create a front-to-back landing mechanism that combines the existing vision-based landing site detection algorithm with the autonomy framework. To accomplish this, both the landing site detection algorithm and the autonomy had to be altered. Last but not least, given that the structure from motion depth generation depends on lateral movement, which is less desirable for a drone navigating at low altitudes in unfamiliar surroundings, the utilization of a stereo camera for low-altitude 3D reconstruction presents a viable solution to attain real-time depth perception without necessitating lateral displacement. Such a stereo camera was implemented in this work representing a lightweight solution that allows a drone to perceive depth statically and in vertical and lateral motion.

\section{My Contribution}
In this work, I established the interface between the vision-based landing site detection algorithm and the autonomy framework to make informed landing decisions based on detected landing sites. A safe and efficient landing mechanism was implemented in the existing autonomy framework. This mechanism utilizes a novel stereo camera 3D reconstruction procedure to avoid lateral motion at low altitudes.

\begin{itemize}
    \item \textbf{Stereo Camera Depth}

    A stereo camera was implemented in the simulated drone model to obtain stereo camera images. A stereo camera depth node was implemented to augment SFM to supply the landing site detection algorithm with a point cloud at low altitudes without necessitating lateral motion. 

    An automatic switch was inserted between the SFM node and the stereo camera depth node, utilizing the already present laser range finder sensor on board. This allows for minimal computational overhead, as only one depth creation node runs at a time.

    \item \textbf{Ground Truth}

    A ground truth depth node was created for two reasons. First, it allowed the validation of the stereo camera depth output. Second, having a perfect point cloud of the terrain made specific testing of the autonomous landing behavior itself possible.

    \item \textbf{Autonomy LSD Interface and Landing Site Handling}

    Initially, the landing site detection output only consisted of one landing site's location. This output was enhanced to utilize many more characteristics already present in the landing site detection algorithm for the autonomy to make a more informed decision regarding what spot to select. These landing site properties are
    
    \begin{itemize}
        \item Terrain roughness
        \item Size
        \item Terrain uncertainty
        \item Detection altitude
        \item Obstacle height
    \end{itemize}

    The autonomy framework was expanded to correctly receive and sort incoming landing sites based on their individual heuristic score. Additional landing site handling mechanisms, such as re-detection, verification, and banishment, were introduced.
    \item \textbf{Behavior Tree for Adaptive Decisions}

    An adaptive landing procedure consisting of both existing and novel actions was implemented using the existing behavior tree structure from the landing state within the autonomy. The implementation of the landing behavior optimizes for both safety and efficiency.
    \item \textbf{Simulation Setup}

    Since the switch to Gazebo Garden was made recently, the entire visual pipeline (SFM + LSD) had never run with this simulation environment before. Therefore, I implemented the changes necessary to run the landing site detection procedure on the Gazebo sensor input. 

    \item \textbf{Analysis of Landing Site Detection Pipeline}

    Though little work was done directly on the SFM and LSD algorithms, substantial testing was performed using these nodes. For the first time, this pipeline was tested and analyzed at the desired 100 m cruise altitude.

    \item \textbf{Deployment of LSD Pipeline onto an Embedded Processor}

    Currently, the drone's processor is modalAI's voxl2. Both the structure from motion and the landing site detection software did not run out of the box because they had incompatible dependency handling with the voxl's AARCH architecture. Resolving these dependency issues, I was able to run the landing site detection pipeline with the structure from motion depth supply on the voxl2 using a collected rosbag of images and respective poses from the xVIO state estimator.
\end{itemize}

\section{Organization of this Thesis}
\begin{itemize}
    \item \textbf{Related Work}

    As is custom, I will introduce the reader to what has been done in this area. The main focus will be placed on vision-based landing site detection procedures and previous work on autonomous landing. 
    \item \textbf{System Overview}

    The existing project architecture will be outlined. Emphasis will be laid on the methods that I have heavily interacted with in this thesis. These are mainly the structure from motion depth generation, the landing site detection mechanism and the autonomy framework.
    \item \textbf{Methodology}

    The high-level structure of the work implemented in this thesis is conceptually laid out here. The two key contributions, stereo depth, and autonomous landing are introduced, as is the ground truth used.

    I will explain why a stereo camera is necessary as a low-altitude depth alternative. Additionally, I analyze the stereo option theoretically and conclude its usage domain.

    I explain the ground truth depth source used in this work both to compare stereo with and to test the autonomous pipeline without the possibility of insufficient depth information. Additionally, I analyze the ground truth's comparability to SFM to ensure adequate testing of the autonomous landing pipeline.

    Lastly, I outline the prerequisites for implementing the autonomous landing behavior and introduce the methodology for the final implementation in the autonomy's behavior tree structure.

    \item \textbf{Stereo Camera Depth Alternative}

    This chapter elaborates on the implementation of stereo camera depth. It displays a coordinate frame overview and discusses the entire process from sensor data handling to point cloud generation. Lastly, the stereo depth output is qualitatively compared to a depth camera-based ground truth.
    \item \textbf{Autonomous Landing Procedure}
    
    Here, I will lay out the core contribution of this project, which combines the existing system with the novel contributions of this work to put together a front-to-back autonomous landing procedure. First, I describe the interface between the autonomy and the landing site detection pipeline. Then I introduce the concept of the landing procedure before I show its implementation in the form of a set of actions structured in a behavior tree. Lastly, the working pipeline is shown in a case example of a science mission flown in simulation.
    \item \textbf{Evaluation}

    Here, I first analyze the landing site acquisition pipeline, examining the current shortcomings of the implementations. I will then introduce the test setup, according to which I performed repeated randomized simulation flights. I then introduce the outcome-defining metrics and the results of the test flights. Lastly, these results are analyzed numerically and visually, considering the final choices of landing sites.
    \item \textbf{Conclusion}

    I summarize this work's novel contributions and conclusively assess the characteristics and quality of the final landing pipeline. Shortcomings of the approach are pointed out, and remedies are discussed.

    \item \textbf{Outlook}

    Potential enhancements to the current system are laid out, and alternatives for future iterations are discussed. Emphasis is also placed on current insufficiencies and the necessity of resolving them.
\end{itemize}